var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);a.prototype=t.prototype,e.prototype=new a},GameObject=function(){function e(){this.compornent=null,this.shapes=[],this.destroyFlag=!1,e.objects.push(this)}return e.init=function(t){e.objects=[],e.display=t},e.prototype.destroy=function(){this.destroyFlag=!0},e.prototype.addDestroyMethod=function(){},e.prototype["delete"]=function(){var t=this;this.addDestroyMethod(),this.shapes&&this.compornent&&(this.shapes.forEach(function(e){t.compornent.removeChild(e),e=null}),this.shapes=[]),Util.remove(e.display,this.compornent)},e.allDestroy=function(){e.objects=e.objects.filter(function(e){return e.destroy(),e["delete"](),!1})},e.update=function(){e.objects.forEach(function(e){return e.updateContent()}),e.objects=e.objects.filter(function(e){return e.destroyFlag&&e["delete"](),!e.destroyFlag}),e.transit&&(e.allDestroy(),e.transit(),e.transit=null)},e.objects=[],e}();__reflect(GameObject.prototype,"GameObject");var GameCompornent=function(e){function t(t,a,o,n){var i=e.call(this)||this;return i.setCompornent(t,a,o,n),i}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,GameStage.display.addChild(this.compornent)},t.prototype["delete"]=function(){var e=this;this.addDestroyMethod(),this.shapes&&this.compornent&&(this.shapes.forEach(function(t){e.compornent.removeChild(t),t=null}),this.shapes=[]),this.compornent&&Util.remove(GameStage.display,this.compornent)},t}(GameObject);__reflect(GameCompornent.prototype,"GameCompornent");var UICompornent=function(e){function t(t,a,o,n){var i=e.call(this)||this;return i.setCompornent(t,a,o,n),i}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,UILayer.display.addChild(this.compornent)},t.prototype["delete"]=function(){var e=this;this.addDestroyMethod(),this.shapes&&this.compornent&&(this.shapes.forEach(function(t){e.compornent.removeChild(t),t=null}),this.shapes=[]),this.compornent&&Util.remove(UILayer.display,this.compornent)},t.compornents=[],t}(GameObject);__reflect(UICompornent.prototype,"UICompornent");var GraphicShape;!function(e){e[e.NONE=Math.pow(2,0)]="NONE",e[e.PLAYER=Math.pow(2,1)]="PLAYER",e[e.RUN=Math.pow(2,2)]="RUN",e[e.TURN=Math.pow(2,3)]="TURN",e[e.TURN_RIGHT=Math.pow(2,4)]="TURN_RIGHT",e[e.TURN_LEFT=Math.pow(2,5)]="TURN_LEFT",e[e.JUMP=Math.pow(2,6)]="JUMP",e[e.START=Math.pow(2,7)]="START",e[e.GAMEOVER=Math.pow(2,8)]="GAMEOVER"}(GraphicShape||(GraphicShape={}));var PhysicsObject=function(e){function t(t,a,o,n){var i=e.call(this,t,a,o,n)||this;return i.body=null,i.bodyShape=null,i.setCompornent(t,a,o,n),i}return __extends(t,e),t.prepare=function(e){t.pixelPerMeter=e,t.meterPerPixel=1/e,t.width=t.pixelToMeter(Util.width),t.height=t.pixelToMeter(Util.height),t.world=new p2.World,t.world.gravity=[0,0]},t.prototype.updateContent=function(){this.fixedUpdate()},t.prototype.updateDrowShape=function(){this.compornent.x=this.body.position[0],this.compornent.y=this.body.position[1]},t.prototype.updateBodyAngle=function(){this.compornent.rotation=this.body.angle},t.prototype.addDestroyMethod=function(){this.body&&(t.world.removeBody(this.body),this.body=null),this.addDestroyPhysicsMethod()},t.prototype.addDestroyPhysicsMethod=function(){},t.step=function(e){return GameOver.gameOverFlag?!0:(t.world.step(1/60,e/1e3,10),!1)},t.pixelToMeter=function(e){return e*t.meterPerPixel},t.meterToPixel=function(e){return e*t.pixelPerMeter},t.prototype.m2p=function(e){return t.meterToPixel(e)},t.prototype.p2m=function(e){return t.pixelToMeter(e)},Object.defineProperty(t.prototype,"px",{get:function(){return t.meterToPixel(this.mx)},set:function(e){this.mx=t.pixelToMeter(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"py",{get:function(){return t.meterToPixel(this.my)},set:function(e){this.my=t.pixelToMeter(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mx",{get:function(){return this.body.position[0]},set:function(e){this.body.position[0]=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"my",{get:function(){return this.body.position[1]},set:function(e){this.body.position[1]=e},enumerable:!0,configurable:!0}),t.world=null,t.deltaScale=1,t}(GameCompornent);__reflect(PhysicsObject.prototype,"PhysicsObject");var SaveData=function(){function e(){}return e.setObject=function(){e.object={gameName:e.gameName,playerID:e.playerID,gameID:e.gameID,registrationDate:CheckDate.registrationDate,lastDate:CheckDate.lastDate,bestScore:Score.bestScore}},e.save=function(){e.object.gameName=e.gameName,e.object.playerID=e.playerID,e.object.gameID=e.gameID,e.object.registrationDate=CheckDate.registrationDate,e.object.lastDate=CheckDate.lastDate,e.object.bestScore=Score.bestScore,Util.saveJSONLocalStrage(e.gameID,e.object),e.test()},e.load=function(){e.object=Util.loadJSONLocalStrage(e.gameID),e.test()},e.deleteData=function(){console.log("データを消去します"),e.object=null,CheckDate.registrationDate=null,Util.clearLocalStrage(e.gameID)},e.testUser=function(){e.deletePlayerID(),e.deleteGameID(),e.deleteData(),e.getPlayerID(),e.getGameID(),e.load(),e.save()},e.init=function(){e.getPlayerID(),e.getGameID(),e.load()},e.getPlayerID=function(){e.playerID=Util.loadStringLocalStrage("playerID"),null==e.playerID&&(console.log("playerIDがありません"),e.setPlayerID())},e.setPlayerID=function(){console.log("playerIDを新規作成"),CheckDate.deleteDate(),CheckDate.getDate(),e.playerID=CheckDate.registrationDate.toString(),Util.saveStringLocalStrage("playerID",e.playerID),console.log("playerIDを作成しました")},e.deletePlayerID=function(){console.log("playerIDを削除します"),Util.clearLocalStrage("playerID")},e.getGameID=function(){e.gameID=e.gameName+e.playerID.toString()},e.setGameID=function(){console.log("gameIDを作成します"),e.gameID=e.gameName+e.playerID.toString()},e.deleteGameID=function(){console.log("gameIDを消去します"),e.gameID=null,Util.clearLocalStrage(e.gameID)},e.test=function(){console.log(e.object)},e.object=null,e.gameName="Zigzag_Dash",e.playerID=null,e.gameID=null,e}();__reflect(SaveData.prototype,"SaveData");var Background=function(e){function t(){var a=e.call(this)||this;return a.color=ColorPallet.BLUE,t.I=a,a.setCompornent(0,0,Game.width,Game.height),a.setShape(0,0,Game.width,Game.height,a.color),a}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,GameObject.display.addChild(this.compornent),this.index=GameObject.display.getChildIndex(this.compornent)},t.prototype.setShape=function(e,t,a,o,n){var i=Util.setRect(e,t,a,o,n,0,!0);this.compornent.addChild(i),this.compornent.addChild(i),this.shapes.push(i)},t.prototype.updateContent=function(){},t.I=null,t}(GameObject);__reflect(Background.prototype,"Background");var Direction;!function(e){e[e.FORWARD=0]="FORWARD",e[e.RIGHT=1]="RIGHT",e[e.LEFT=-1]="LEFT"}(Direction||(Direction={}));var Player=function(e){function t(a,o,n,i){var r=e.call(this,a,o,n,i)||this;return r.velocityLimit=10,r.acceleration=[0,0],r.speed=5.5,r.plusSpeed=0,r.targetPoint=[0,0],r.toMoveAngle=270,r.touchNubmer=0,r.alreadyClick=!1,r.direction=0,t.I=r,r.ballPosX=a,r.ballPosY=o,r.setBody(a,o,5),r.setShape(0,0,n/2,ColorPallet.RED),GameStage.moveOffset(r.ballPosX,r.ballPosY),r.body.position[0]=Start.start[0].compornent.x+Game.mapChipWidth/2,r.body.position[1]=Start.start[0].compornent.y+Game.mapChipHeight/2,PhysicsObject.world.on("beginContact",r.collision,r),r}return __extends(t,e),t.prototype.setShape=function(e,t,a,o){var n=Util.setCircle(e,t,a,o,!0);this.compornent.addChild(n),this.shapes.push(n)},t.prototype.setBody=function(e,t,a){this.body=new p2.Body({mass:1,angle:270,position:[e,t]}),this.bodyShape=new p2.Circle({radius:a,fixedRotation:!0,fixedX:!0,fixedY:!0,collisionGroup:GraphicShape.PLAYER,collisionMask:GraphicShape.START|GraphicShape.GAMEOVER}),this.body.addShape(this.bodyShape),PhysicsObject.world.addBody(this.body)},t.prototype.addDestroyPhysicsMethod=function(){PhysicsObject.world.off("beginContact",this.collision),this.speed=7},t.prototype.collision=function(e){var t=(e.bodyA,e.shapeA),a=(e.bodyB,e.shapeB);if((t.collisionGroup==GraphicShape.GAMEOVER||a.collisionGroup==GraphicShape.GAMEOVER)&&(GameOver.gameOverFlag=!0,this.smallPlayer(this.compornent,0)),t.collisionGroup==GraphicShape.START||a.collisionGroup==GraphicShape.START){var o=Util.randomInt(1,CourseType.I);Map.I.createMap(o),this.plusSpeed<3?this.plusSpeed+=.05:this.plusSpeed>=3&&(this.plusSpeed=3);var n=Util.randomInt(Type.NORMAL,Type.SPEED_ROTATE_ZOOM);Camera2D.type=n,this.changeCameraType(),Score.addScore()}},t.prototype.changeCameraType=function(){function e(){t.I.cameraZoom(GameStage.display,CameraScale.NORMAL)}function a(){t.I.cameraZoom(GameStage.display,CameraScale.ZOOM_IN)}function o(){t.I.cameraZoom(GameStage.display,CameraScale.ZOOM_OUT)}function n(){t.I.speed=6.5+t.I.plusSpeed}function i(){t.I.speed=6.5+t.I.plusSpeed}switch(Camera2D.type){case Type.NORMAL:e(),n();break;case Type.ROTATE:e(),n();break;case Type.ZOOM:Camera2D.scale==CameraScale.ZOOM_IN?e():Camera2D.scale==CameraScale.NORMAL?a():Camera2D.scale==CameraScale.ZOOM_OUT&&e(),n();break;case Type.ROTATE_ZOOM:Camera2D.scale==CameraScale.ZOOM_IN?e():Camera2D.scale==CameraScale.NORMAL?a():Camera2D.scale==CameraScale.ZOOM_OUT&&e(),n();break;case Type.SPEED:o(),i();break;case Type.SPEED_NORMAL:o(),i();break;case Type.SPEED_ROTATE:o(),i();break;case Type.SPEED_ZOOM:Camera2D.scale==CameraScale.ZOOM_OUT?e():Camera2D.scale==CameraScale.NORMAL?o():Camera2D.scale==CameraScale.ZOOM_IN&&e(),i();break;case Type.SPEED_ROTATE_ZOOM:Camera2D.scale==CameraScale.ZOOM_OUT?e():Camera2D.scale==CameraScale.NORMAL?o():Camera2D.scale==CameraScale.ZOOM_IN&&e(),i()}},t.prototype.setToMoveAngle=function(){if(Turn.turn.length<=this.touchNubmer)return void console.log("turnがありません");if(Turn.turn[this.touchNubmer].turnRight?this.toMoveAngle+=90:Turn.turn[this.touchNubmer].turnRight||(this.toMoveAngle-=90),Camera2D.type==Type.ROTATE||Camera2D.type==Type.ROTATE_ZOOM||Camera2D.type==Type.SPEED_ROTATE||Camera2D.type==Type.SPEED_ROTATE_ZOOM){if(Turn.turn[t.I.touchNubmer].turnRight)switch(t.I.direction){case Direction.FORWARD:t.I.direction=Direction.RIGHT,Camera2D.angle=-45;break;case Direction.LEFT:t.I.direction=Direction.FORWARD,Camera2D.angle=0}else if(!Turn.turn[t.I.touchNubmer].turnRight)switch(t.I.direction){case Direction.FORWARD:t.I.direction=Direction.LEFT,Camera2D.angle=45;break;case Direction.RIGHT:t.I.direction=Direction.FORWARD,Camera2D.angle=0}t.I.cameraRotate(GameStage.display,Camera2D.angle)}this.changeCameraType(),this.body.angle<0?(this.body.angle%=360,this.body.angle+=360):this.body.angle>360&&(this.body.angle%=360),this.body.angle=this.toMoveAngle,this.touchNubmer++,this.alreadyClick=!0},t.prototype.cameraRotate=function(e,t){egret.Tween.get(e).to({rotation:t},150,egret.Ease.quadIn).call(function(){Camera2D.angle=t})},t.prototype.cameraZoom=function(e,t){egret.Tween.get(e).to({scaleX:t,scaleY:t},150,egret.Ease.quadIn).call(function(){Camera2D.scale=t})},t.prototype.smallPlayer=function(e,t){egret.Tween.get(e).to({scaleX:t,scaleY:t},300,egret.Ease.quadIn).call(function(){new GameOver(0,0,0,0),new RetryButton(Game.width/2,.7*Game.height,.4*Game.width,.18*Game.width,80,.5,"リトライ")})},t.prototype.move=function(){this.body.position[0]+=Math.cos(Util.toRadian(this.body.angle))*this.speed,this.body.position[1]+=Math.sin(Util.toRadian(this.body.angle))*this.speed},t.prototype.turn=function(){UILayer.onRight?this.body.angle+=3:UILayer.onLeft&&(this.body.angle-=3),this.body.angle<0?(this.body.angle%=360,this.body.angle+=360):this.body.angle>360&&(this.body.angle%=360)},t.prototype.fixedUpdate=function(){if(!GameOver.gameOverFlag){if(0==t.gameStart)return this.updateDrowShape(),this.updateBodyAngle(),Camera2D.x=Game.width/2/Camera2D.scale,Camera2D.y=Game.height/2/Camera2D.scale,GameStage.moveOffset(this.compornent.x,this.compornent.y),void Camera2D.transform(GameStage.display);this.move(),this.updateDrowShape(),this.updateBodyAngle(),Camera2D.x=Game.width/2/Camera2D.scale,Camera2D.y=Game.height/2/Camera2D.scale,GameStage.moveOffset(this.compornent.x,this.compornent.y),Camera2D.transform(GameStage.display)}},t.prototype.getPosX=function(){return this.body.position[0]},t.prototype.setPosX=function(e){this.body.position[0]=e},t.prototype.getPosY=function(){return this.body.position[1]},t.prototype.setPosY=function(e){this.body.position[1]=e},t.prototype.getBodyAngle=function(){return this.body.angle},t.prototype.setBodyAngle=function(e){this.body.angle=e},t.prototype.getVelocity=function(){return this.body.velocity},t.prototype.setVelocity=function(e){this.body.velocity=e},t.I=null,t.gameStart=!1,t}(PhysicsObject);__reflect(Player.prototype,"Player");var Type;!function(e){e[e.NORMAL=0]="NORMAL",e[e.ROTATE=1]="ROTATE",e[e.ZOOM=2]="ZOOM",e[e.SPEED=3]="SPEED",e[e.ROTATE_ZOOM=4]="ROTATE_ZOOM",e[e.SPEED_NORMAL=5]="SPEED_NORMAL",e[e.SPEED_ROTATE=6]="SPEED_ROTATE",e[e.SPEED_ZOOM=7]="SPEED_ZOOM",e[e.SPEED_ROTATE_ZOOM=8]="SPEED_ROTATE_ZOOM"}(Type||(Type={}));var CameraScale;!function(e){e[e.NORMAL=1.6]="NORMAL",e[e.ZOOM_IN=2]="ZOOM_IN",e[e.ZOOM_OUT=1.2]="ZOOM_OUT"}(CameraScale||(CameraScale={}));var Camera2D=function(){function e(){}return e.initial=function(){e.x=0,e.y=0,e.angle=0,e.scale=CameraScale.NORMAL},e.transform=function(t){t.x=e.transX(t.x),t.y=e.transY(t.y),t.scaleX=t.scaleY=e.scale},e.transX=function(t){return e.x*e.scale},e.transY=function(t){return e.y*e.scale},e.x=0,e.y=0,e.angle=0,e.scale=1,e.type=Type.NORMAL,e}();__reflect(Camera2D.prototype,"Camera2D");var GameOver=function(e){function t(a,o,n,i){var r=e.call(this,a,o,n,i)||this;return r.textGameOver=null,r.textScore=null,r.textColor=ColorPallet.BLACK,t.gameOverFlag=!0,r.textGameOver=Util.myText(Game.width/2,.44*Game.height-60,"GAME OVER",80,1,r.textColor,!0),r.textGameOver.anchorOffsetX=r.textGameOver.width/2,r.textGameOver.anchorOffsetY=r.textGameOver.height/2,r.compornent.addChild(r.textGameOver),r.textScore=Util.myText(Game.width/2,.44*Game.height+60,"SCORE : "+Score.score,80,1,r.textColor,!0),r.textScore.anchorOffsetX=r.textScore.width/2,r.textScore.anchorOffsetY=r.textScore.height/2,r.compornent.addChild(r.textScore),Score.I.saveBestScore(),r}return __extends(t,e),t.prototype.addDestroyMethod=function(){this.compornent&&this.compornent.removeChildren(),this.textGameOver=null,this.textScore=null},t.prototype.updateContent=function(){},t.tap=function(){UILayer.I.remove(),GameObject.transit=Game.init},t.gameOverFlag=!1,t}(UICompornent);__reflect(GameOver.prototype,"GameOver");var ColorPallet;!function(e){e[e.WHITE=16777215]="WHITE",e[e.RED=15618643]="RED",e[e.BLUE=4774907]="BLUE",e[e.GREEN=9034329]="GREEN",e[e.VERMILION=16353382]="VERMILION",e[e.BLACK=2240318]="BLACK"}(ColorPallet||(ColorPallet={}));var PIXEL_PER_METER=1,Main=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(t,e),t.prototype.addToStage=function(){Util.init(this),CheckDate.init(),SaveData.init(),GameObject.init(this.stage),PhysicsObject.prepare(PIXEL_PER_METER),Camera2D.initial(),Game.init(),egret.startTick(this.tickLoop,this)},t.prototype.tickLoop=function(e){return PhysicsObject.step(e),GameObject.update(),!1},t}(eui.UILayer);__reflect(Main.prototype,"Main");var Game=function(){function e(){}return e.init=function(){this.width=egret.MainContext.instance.stage.stageWidth,this.height=egret.MainContext.instance.stage.stageHeight,this.mapChipWidth=this.width/9,this.mapChipHeight=this.height/16,Player.gameStart=!1,GameOver.gameOverFlag=!1,Camera2D.initial(),Turn.turn=[],Turn.chipNumber=0,Start.start=[],new Background,new GameStage,new UILayer,new Map,new Player(e.width/2,e.height/2,.8*e.mapChipWidth,.8*e.mapChipWidth),new Description(0,0,0,0,ColorPallet.BLACK),new Score(0,0,0,0,ColorPallet.BLACK)},e}();__reflect(Game.prototype,"Game");var ChipType;!function(e){e[e.NONE=0]="NONE",e[e.LOAD=1]="LOAD",e[e.RUN=2]="RUN",e[e.TURN=3]="TURN",e[e.TURN_RIGHT=4]="TURN_RIGHT",e[e.TURN_LEFT=5]="TURN_LEFT",e[e.JUMP=6]="JUMP",e[e.JUMP_END=7]="JUMP_END",e[e.START=8]="START",e[e.GAMEOVER=9]="GAMEOVER"}(ChipType||(ChipType={}));var MapType;!function(e){e[e.STRAIGHT_UP=0]="STRAIGHT_UP",e[e.STRAIGHT_RIGHT=1]="STRAIGHT_RIGHT",e[e.RIGHT_CURVE=2]="RIGHT_CURVE",e[e.RIGHT_CURVE_REVERSE=3]="RIGHT_CURVE_REVERSE",e[e.RIGHT_CURVE_ZIGZAG=4]="RIGHT_CURVE_ZIGZAG",e[e.RIGHT_CURVE_ZIGZAG2=5]="RIGHT_CURVE_ZIGZAG2",e[e.START=6]="START"}(MapType||(MapType={}));var CourseType;!function(e){e[e.NONE=0]="NONE",e[e.A=1]="A",e[e.B=2]="B",e[e.C=3]="C",e[e.D=4]="D",e[e.E=5]="E",e[e.F=6]="F",e[e.G=7]="G",e[e.H=8]="H",e[e.I=9]="I"}(CourseType||(CourseType={}));var Map=function(e){function t(){var a=e.call(this)||this;t.I=a;var o=Util.randomInt(1,CourseType.I);return a.createMap(o),a}return __extends(t,e),t.prototype.createMap=function(e){switch(e){case CourseType.NONE:break;case CourseType.A:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE,!1),this.setMap(MapType.STRAIGHT_RIGHT,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.B:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.C:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.RIGHT_CURVE,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.D:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.E:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!1),this.setMap(MapType.STRAIGHT_RIGHT,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.F:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE_ZIGZAG,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.G:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE_ZIGZAG,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.H:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE_ZIGZAG2,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.STRAIGHT_UP,!1);break;case CourseType.I:this.setMap(MapType.START,!1),this.setMap(MapType.RIGHT_CURVE,!0),this.setMap(MapType.STRAIGHT_RIGHT,!0),this.setMap(MapType.RIGHT_CURVE_REVERSE,!1),this.setMap(MapType.RIGHT_CURVE_ZIGZAG2,!1),this.setMap(MapType.RIGHT_CURVE_REVERSE,!0),this.setMap(MapType.STRAIGHT_UP,!1)}},t.prototype.setMap=function(e,a){for(var o=this.map(e),n=0,i=0,r=0;r<o.length;r++)for(var s=0;s<o[r].length;s++){var p=this.checkReverseOrderX(s,r,o,a),c=this.reverseOrderY(r,o);n=a?Game.mapChipWidth*(o[c].length-1-p)+t.createLineX:Game.mapChipWidth*p+t.createLineX,i=Game.mapChipHeight*c+t.createLineY,o[c][p]===ChipType.NONE||(o[c][p]===ChipType.RUN?new Run(n,i,Game.mapChipWidth,Game.mapChipHeight):o[c][p]===ChipType.TURN_RIGHT?new Turn(n,i,Game.mapChipWidth,Game.mapChipHeight,GraphicShape.TURN_RIGHT,e,a,!0,!1):o[c][p]===ChipType.TURN_LEFT?new Turn(n,i,Game.mapChipWidth,Game.mapChipHeight,GraphicShape.TURN_LEFT,e,a,!1,!1):o[c][p]===ChipType.START?new Start(n,i,Game.mapChipWidth,Game.mapChipHeight):o[c][p]===ChipType.GAMEOVER&&new GameOverChip(n,i,Game.mapChipWidth,Game.mapChipHeight))}this.setCreateLine(e,a)},t.prototype.checkReverseOrderX=function(e,t,a,o){var n=e;return o&&(n=a[t].length-1-e),n},t.prototype.reverseOrderY=function(e,t){var a=e;return a=t.length-1-e},t.prototype.map=function(e){var t=[];switch(e){case MapType.STRAIGHT_UP:t=[[9,2,9],[9,2,9],[9,2,9],[9,2,9]];break;case MapType.STRAIGHT_RIGHT:t=[[9,9,9],[2,2,2],[9,9,9],[9,0,0]];break;case MapType.RIGHT_CURVE:t=[[9,9,9],[9,4,2],[9,2,9],[9,2,9]];break;case MapType.RIGHT_CURVE_REVERSE:t=[[9,2,9],[9,4,2],[9,9,9],[0,0,9]];break;case MapType.RIGHT_CURVE_ZIGZAG:t=[[0,0,9],[0,9,4],[9,4,5],[9,2,9]];break;case MapType.RIGHT_CURVE_ZIGZAG2:t=[[0,0,9],[0,9,4],[0,9,2],[9,4,5]];break;case MapType.START:t=[[9,2,9],[9,2,9],[9,2,9],[9,8,9]]}return t},t.prototype.setCreateLine=function(e,a){switch(e){case MapType.STRAIGHT_UP:t.createLineY-=Game.height/4;break;case MapType.STRAIGHT_RIGHT:a?t.createLineX-=Game.width/3:t.createLineX+=Game.width/3;break;case MapType.RIGHT_CURVE:a?t.createLineX-=Game.width/3:t.createLineX+=Game.width/3;break;case MapType.RIGHT_CURVE_REVERSE:a?t.createLineY-=Game.height/4:t.createLineY-=Game.height/4;break;case MapType.RIGHT_CURVE_ZIGZAG:a?t.createLineX-=Game.width/3:t.createLineX+=Game.width/3;break;case MapType.RIGHT_CURVE_ZIGZAG2:a?t.createLineX-=Game.width/3:t.createLineX+=Game.width/3;break;case MapType.START:t.createLineY-=Game.height/4}},t.prototype.updateContent=function(){},t.prototype.addDestroyMethod=function(){t.createLineX=0,t.createLineY=0},t.I=null,t.createLineX=0,t.createLineY=0,t}(GameObject);__reflect(Map.prototype,"Map");var Chip=function(e){function t(t,a,o,n){return e.call(this,t,a,o,n)||this}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,GameStage.display.addChildAt(this.compornent,Background.I.index)},t.prototype.setShape=function(e,t,a,o,n){var i=Util.setRect(e,t,a,o,n,0,!0,4);this.compornent.addChild(i),this.shapes.push(i)},t.prototype.updateContent=function(){Player.I.compornent.y+Game.height/2<this.compornent.y&&this.destroy()},t}(GameCompornent);__reflect(Chip.prototype,"Chip");var None=function(e){function t(t,a,o,n){return e.call(this,t,a,o,n)||this}return __extends(t,e),t}(Chip);__reflect(None.prototype,"None");var Run=function(e){function t(t,a,o,n){var i=e.call(this,t,a,o,n)||this;return i.setShape(0,0,o,n,ColorPallet.WHITE),i}return __extends(t,e),t}(Chip);__reflect(Run.prototype,"Run");var GameOverChip=function(e){function t(t,a,o,n){var i=e.call(this,t,a,o,n)||this;return i.setBody(t,a,o,n,GraphicShape.GAMEOVER),i}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,GameStage.display.addChildAt(this.compornent,Background.I.index)},t.prototype.setShape=function(e,t,a,o,n){var i=Util.setRect(e,t,a,o,n,0,!0);this.compornent.addChild(i),this.shapes.push(i)},t.prototype.setBody=function(e,t,a,o,n){this.body=new p2.Body({position:[e,t],type:p2.Body.STATIC}),this.bodyShape=new p2.Box({width:a,height:o,fixedRotation:!0,sensor:!0,fixedX:!0,fixedY:!0,collisionGroup:n,collisionMask:GraphicShape.PLAYER}),this.body.position[0]+=a/2,this.body.position[1]+=o/2,this.body.addShape(this.bodyShape),PhysicsObject.world.addBody(this.body)},t.prototype.fixedUpdate=function(){Player.I.compornent.y+Game.height/2<this.compornent.y&&this.destroy()},t}(PhysicsObject);__reflect(GameOverChip.prototype,"GameOverChip");var Start=function(e){function t(a,o,n,i){var r=e.call(this,a,o,n,i)||this;return r.number=0,r.setBody(a,o,n/2,GraphicShape.START),r.setShape(0,0,n/2*3,ColorPallet.WHITE),t.start.push(r),r}return __extends(t,e),t.prototype.setCompornent=function(e,t,a,o){this.compornent=new egret.DisplayObjectContainer,this.compornent.x=e,this.compornent.y=t,this.compornent.width=a,this.compornent.height=o,GameStage.display.addChildAt(this.compornent,Background.I.index)},t.prototype.setBody=function(e,t,a,o){this.body=new p2.Body({position:[e,t],type:p2.Body.STATIC}),this.bodyShape=new p2.Circle({radius:a,fixedRotation:!0,sensor:!0,fixedX:!0,fixedY:!0,collisionGroup:o,collisionMask:GraphicShape.PLAYER}),this.body.position[0]+=a,this.body.position[1]+=a,this.body.addShape(this.bodyShape),PhysicsObject.world.addBody(this.body)},t.prototype.setShape=function(e,t,a,o){var n=Util.setCircle(e,t,a,o,!0);this.compornent.anchorOffsetX-=this.compornent.width/2,this.compornent.anchorOffsetY-=this.compornent.height/2,this.compornent.addChild(n),this.shapes.push(n)},t.prototype.fixedUpdate=function(){Player.I.compornent.y+Game.height/2<this.compornent.y&&this.destroy()},t.start=[],t.chipNumber=0,t}(PhysicsObject);__reflect(Start.prototype,"Start");var Turn=function(e){function t(a,o,n,i,r,s,p,c,h){var l=e.call(this,a,o,n,i)||this;return l.number=0,l.turnRight=!1,l.jump=!1,l.setShape(0,0,n,i,ColorPallet.WHITE),t.turn.push(l),l.number=t.chipNumber,t.chipNumber+=1,p?l.turnRight=!c:l.turnRight=c,l.jump=h,l.replaceTurnChip(s,l.number,p),l}return __extends(t,e),t.prototype.replaceTurnChip=function(e,a,o){if(!(0>a-1)&&o&&(e==MapType.RIGHT_CURVE_ZIGZAG||e==MapType.RIGHT_CURVE_ZIGZAG2)){if(t.turn[a].compornent.y!=t.turn[a-1].compornent.y)return;if(t.turn[a].compornent.x<=t.turn[a-1].compornent.x)return;if(t.turn[a].number>t.turn[a-1].number){var n=t.turn[a],i=t.turn[a-1];t.turn[a]=i,t.turn[a-1]=n}}},t.prototype.fixedUpdate=function(){},t.turn=[],t.chipNumber=0,t}(Chip);__reflect(Turn.prototype,"Turn");var Util=function(){function e(){}return e.init=function(e){this.height=e.stage.stageHeight,this.width=e.stage.stageWidth,this.ui=e},e.random=function(e,t){return e+Math.random()*(t-e)},e.randomInt=function(e,t){return Math.floor(e+Math.random()*(t+.999-e))},e.clamp=function(e,t,a){return t>e&&(e=t),e>a&&(e=a),e},e.color=function(e,t,a){var o=e.toFixed(0),n=t.toFixed(0),i=a.toFixed(0);o=e.toString(16),n=t.toString(16),i=a.toString(16),o=("00"+o).slice(-2),n=("00"+n).slice(-2),i=("00"+i).slice(-2);var r=parseInt("0x"+o+n+i,16);return r},e.myText=function(e,t,a,o,n,i,r){var s=new eui.Label;return s.scaleX=n,s.scaleY=n,s.bold=r,s.size=o,s.text=a,s.textColor=i,s.x=e,s.y=t,s.multiline=!0,s},e.myStrokeText=function(e,t,a,o,n,i,r,s,p){var c=new eui.Label;return c.x=e,c.y=t,c.scaleX=n,c.scaleY=n,c.textFlow=[{text:a,style:{textColor:i,size:o,fontFamily:r,strokeColor:s,stroke:p}}],c},e.saveLocalStrage=function(e,t){window.localStorage.setItem(e,t.toString())},e.loadLocalStrage=function(e,t){var a=window.localStorage.getItem(e);null==a&&(a=t.toString(),window.localStorage.setItem(e,a.toString()));var o=parseInt(a);return o},e.saveStringLocalStrage=function(e,t){window.localStorage.setItem(e,t)},e.loadStringLocalStrage=function(e){var t=window.localStorage.getItem(e),a=t;return a},e.clearLocalStrage=function(e){e&&window.localStorage.removeItem(e)},e.saveJSONLocalStrage=function(e,t){var a=JSON.stringify(t);window.localStorage.setItem(e,a)},e.loadJSONLocalStrage=function(e){var t=window.localStorage.getItem(e);null==t&&(SaveData.setObject(),t=JSON.stringify(SaveData.object),window.localStorage.setItem(e,t));var a=JSON.parse(t);return a},e.setRect=function(e,t,a,o,n,i,r,s,p){var c=new egret.Shape;return c.x=e,c.y=t,r?(s&&(p||(p=n),c.graphics.lineStyle(s,p)),c.graphics.beginFill(n),c.graphics.drawRoundRect(0,0,a,o,i),c.graphics.endFill()):(c.graphics.lineStyle(s,n),c.graphics.drawRoundRect(0,0,a,o,i)),c},e.setCircle=function(e,t,a,o,n,i){var r=new egret.Shape;return r.x=e,r.y=t,n?(r.graphics.beginFill(o),r.graphics.drawCircle(0,0,a),r.graphics.endFill()):(r.graphics.lineStyle(i,o),r.graphics.drawCircle(0,0,a)),r},e.setEllipse=function(e,t,a,o,n,i,r){var s=new egret.Shape;return s.x=e,s.y=t,i?(s.graphics.beginFill(n),s.graphics.drawEllipse(0,0,a,o),s.graphics.endFill()):(s.graphics.lineStyle(r,n),s.graphics.drawEllipse(0,0,a,o)),s},e.setLine=function(e,t,a,o,n,i){var r=(360-o)*Math.PI/180,s=new egret.Shape;return s.x=e,s.y=t,s.graphics.lineStyle(n,i),s.graphics.moveTo(e,t),s.graphics.lineTo(a*Math.cos(r),a*Math.sin(r)),s},e.remove=function(e,t){e&&t&&e.removeChild(t),t=null},e.toRadian=function(e){var t=e*Math.PI/180;return t%=2*Math.PI,0>t&&(t+=2*Math.PI),t},e.toDegree=function(e){var t=e/(Math.PI/180);return t%=360,0>t&&(t+=360),t},e.vector=function(e,t,a,o){var n=t*Math.PI/180,i=[];return void 0==a&&void 0==o?(i[0]=e*Math.cos(n),i[1]=e*Math.sin(n)):(i[0]=e*Math.cos(n)-a,i[1]=e*Math.sin(n)-o),i[2]=e,i},e.cross=function(e,t){var a=e[0]*t[1]-e[1]*t[0];return a},e.dot=function(e,t){var a=e[0]*t[0]+e[1]*t[1];return a},e.cos=function(t,a){var o=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)),n=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));0>o&&(o*=-1),0>n&&(n*=-1);var i=e.dot(t,a)/(o*n);return i},e.sin=function(t,a){var o=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)),n=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));0>o&&(o*=-1),0>n&&(n*=-1);var i=e.cross(t,a)/(o*n);return i},e.size=function(e){var t=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));return t},e}();__reflect(Util.prototype,"Util");var Button=function(e){function t(t,a,o,n,i){var r=e.call(this,t,a,o,n)||this;return r.indexText=null,r.indexTextColor=ColorPallet.WHITE,r.shapeColor=ColorPallet.BLACK,r.mask=null,r.maskColor=ColorPallet.WHITE,r.onMask=!1,r.setCompornentStatus(t,a,o,n),r}return __extends(t,e),t.prototype.setCompornentStatus=function(e,t,a,o){this.compornent.touchEnabled=!0,this.compornent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tap,this)},t.prototype.setShape=function(e,t,a,o,n){n&&(this.shapeColor=n),this.shapes[0]=Util.setRect(e,t,a,o,this.shapeColor,70,!0),this.compornent.addChild(this.shapes[0])},t.prototype.setMask=function(e,t,a,o,n){n&&(this.maskColor=n),this.mask=Util.setRect(e,t,a,o,this.maskColor,70,!0),this.mask.alpha=0,this.shapes[1]=this.mask,this.compornent.addChild(this.mask)},t.prototype.setIndexText=function(e,t,a,o,n,i,r){this.indexText=Util.myText(e,t,r,n,i,this.indexTextColor,!0),this.indexText.anchorOffsetX=this.indexText.width/2,this.indexText.anchorOffsetY=this.indexText.height/2,this.indexText.x+=this.compornent.width/2,this.indexText.y+=this.compornent.height/2,this.indexText.textAlign=egret.HorizontalAlign.CENTER,this.indexText.verticalAlign=egret.VerticalAlign.MIDDLE,this.compornent.addChild(this.indexText)},t.prototype.addDestroyMethod=function(){this.compornent.hasEventListener&&this.compornent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tap,this),this.indexText&&(this.compornent.removeChild(this.indexText),this.indexText=null)},t}(UICompornent);__reflect(Button.prototype,"Button");var RetryButton=function(e){function t(t,a,o,n,i,r,s){var p=e.call(this,t,a,o,n,s)||this;return p.onTouch=!1,p.setShape(0,0,o,n),p.setIndexText(0,0,o,n,i,r,s),p.setMask(t,a,o,n),p.compornent.anchorOffsetX+=p.compornent.width/2,p.compornent.anchorOffsetY+=p.compornent.height/2,p}return __extends(t,e),t.prototype.tap=function(){this.onTouch||(this.onTouch=!0,this.pushEffect(this.compornent,1.15))},t.prototype.pushEffect=function(e,t){egret.Tween.get(e).to({scaleX:t,scaleY:t},50,egret.Ease.quadIn).to({scaleX:1,scaleY:1},100).call(function(){GameOver.tap()
})},t.prototype.updateContent=function(){},t}(Button);__reflect(RetryButton.prototype,"RetryButton");var CheckDate=function(){function e(){}return e.init=function(){e.getDate()},e.getDate=function(){!function(){var t=window.localStorage.getItem("registrationDate");(null==t||void 0==t)&&(t=(new Date).getTime().toString(),window.localStorage.setItem("registrationDate",t)),e.registrationDate=parseInt(t)}(),function(){var t=new Date;e.lastDate=t.getTime(),e.lastDate=parseInt(e.lastDate.toString())}()},e.save=function(){SaveData.object.registrationDate=e.registrationDate,SaveData.object.lastDate=e.lastDate,SaveData.save()},e.deleteDate=function(){e.registrationDate=null,e.lastDate=null,Util.clearLocalStrage("registrationDate")},e.I=null,e.registrationDate=null,e.lastDate=null,e}();__reflect(CheckDate.prototype,"CheckDate");var Description=function(e){function t(a,o,n,i,r){var s=e.call(this,a,o,n,i)||this;return s.text=null,s.textBest=null,s.textColor=0,t.I=s,s.textColor=r,s.setText(),UILayer.display.once(egret.TouchEvent.TOUCH_BEGIN,s.push,s),s}return __extends(t,e),t.prototype.setText=function(){var e="タップで方向転換\n\n壁に当たるとゲームオーバー";this.text=Util.myText(Game.width/2,Game.height/2.4,e,90,.5,this.textColor,!0),this.text.anchorOffsetX=this.text.width/2,this.text.anchorOffsetY=this.text.height/2,this.text.textAlign=egret.HorizontalAlign.CENTER,this.compornent.addChild(this.text)},t.prototype.addDestroyMethod=function(){this.compornent&&this.compornent.removeChildren(),this.text=null},t.prototype.updateContent=function(){},t.prototype.push=function(){Player.gameStart=!0,this.destroy()},t.I=null,t}(UICompornent);__reflect(Description.prototype,"Description");var GameStage=function(e){function t(){var a=e.call(this)||this;return a.setContainer(),t.index=GameObject.display.getChildIndex(t.display),a}return __extends(t,e),t.prototype.setContainer=function(){t.display=new egret.DisplayObjectContainer,GameObject.display.addChild(t.display)},t.prototype.addDestroyMethod=function(){t.display&&(t.display.removeChildren(),GameObject.display.removeChild(t.display),t.display=null)},t.moveOffset=function(e,a){var o=e,n=a;t.display.anchorOffsetX=o,t.display.anchorOffsetY=n},t.prototype.updateContent=function(){},t.display=null,t}(GameObject);__reflect(GameStage.prototype,"GameStage");var Score=function(e){function t(a,o,n,i,r){var s=e.call(this,a,o,n,i)||this;return s.text=null,s.textBest=null,s.textColor=0,t.I=s,t.score=0,t.bestScore=0,s.textColor=r,t.bestScore=SaveData.object.bestScore,s.setText(),s}return __extends(t,e),t.prototype.setText=function(){this.text=Util.myText(Game.width/2*0,0,"0",60,.5,this.textColor,!0),this.text.anchorOffsetX=this.text.width/2,this.compornent.addChild(this.text),this.textBest=Util.myText(0,0,"BEST:"+t.bestScore.toString(),60,.5,this.textColor,!0),t.bestScore=SaveData.object.bestScore,this.textBest.text="BEST:"+t.bestScore.toString(),this.compornent.addChild(this.textBest)},t.prototype.saveBestScore=function(){t.bestScore>SaveData.object.bestScore&&(SaveData.object.bestScore=t.bestScore,SaveData.save())},t.prototype.addDestroyMethod=function(){this.compornent&&(this.compornent.removeChildren(),this.compornent=null),this.text=null,this.textBest=null,t.score=0},t.prototype.updateContent=function(){this.text.text=t.score.toFixed(),this.text.anchorOffsetX=this.text.width/2,this.text.x=Game.width/2,t.bestScore<t.score&&(t.bestScore=t.score,this.textBest.text="BEST:"+t.bestScore.toFixed())},t.addScore=function(){t.score+=1},t.I=null,t.score=0,t.bestScore=0,t}(UICompornent);__reflect(Score.prototype,"Score");var UILayer=function(){function e(){this.pushPos=[0,0],this.releasePos=[0,0],this.initialBallPos=[0,0],this.displayRotation=90,e.I=this,this.setContainer(),e.index=GameObject.display.getChildIndex(e.display),e.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.push,this),e.display.addEventListener(egret.TouchEvent.TOUCH_END,this.end,this)}return e.prototype.setContainer=function(){e.display=new eui.UILayer,GameObject.display.addChild(e.display)},e.prototype.push=function(){GameOver.gameOverFlag||Player.gameStart&&(e.onTouch=!0,Player.I.setToMoveAngle(),Score.addScore())},e.prototype.end=function(){e.onTouch=!1},e.prototype.turnRight=function(t){t?(e.onRight=!0,e.onLeft=!1):(e.onRight=!1,e.onLeft=!0)},e.prototype.remove=function(){e.display&&(e.display.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.push,this),e.display.removeEventListener(egret.TouchEvent.TOUCH_END,this.end,this),e.display.removeChildren(),GameObject.display.removeChild(e.display),e.display=null)},e.I=null,e.display=null,e.onTouch=!1,e.onLeft=!1,e.onRight=!1,e}();__reflect(UILayer.prototype,"UILayer");